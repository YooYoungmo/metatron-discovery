<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<script src="../data-aggregate.component.ts"></script>
<div class="ddp-pop-preview ddp-type" *ngIf="isShow">
  <!-- top -->
  <div class="ddp-ui-top">
    <div class="ddp-data-name">
      쿼리 반복 작업 상세 - {{taskName}}
    </div>
    <em class="ddp-btn-popup-close" (click)="close()"></em>
  </div>
  <!-- //top -->
  <!-- cpmtemts -->
  <div class="ddp-ui-preview-contents ddp-more-table">
    <div class="ddp-ui-datadetail ddp-border-none">
      <label class="ddp-label-detail" style="color: #4c515a; font-size: 16px;font-weight: 700;">Query</label>
      <table class="ddp-table-detail">
        <colgroup>
          <col width="133px">
          <col width="*">
        </colgroup>
        <tbody>
        <tr>
          <th>Database</th>
          <td>
            <code>
              {{dataAggregateTaskDetails.taskInformation.source.database}}
            </code>
          </td>
        </tr>
        <tr>
          <th>SQL</th>
          <td>
            <code>
              {{dataAggregateTaskDetails.taskInformation.source.query}}
            </code>
          </td>
        </tr>
        <tr>
          <th>범위</th>
          <td>
            {{dataAggregateTaskDetails.taskInformation.loopRange.from}} - {{dataAggregateTaskDetails.taskInformation.loopRange.to}}
          </td>
        </tr>
        </tbody>
      </table>

      <label class="ddp-label-detail" style="color: #4c515a;font-size: 16px;font-weight: 700; margin-top:20px;">Insert Table</label>
      <table class="ddp-table-detail">
        <colgroup>
          <col width="133px">
          <col width="*">
        </colgroup>
        <tbody>
        <tr>
          <th> Database/Table </th>
          <td>
            {{dataAggregateTaskDetails.taskInformation.target.database}} / {{dataAggregateTaskDetails.taskInformation.target.table}}
          </td>
        </tr>
        </tbody>
      </table>

      <div class="ddp-wrap-table-detail">
        <div class="ddp-wrap-edit3">
          <div class="ddp-ui-label-name">
            실행 이력
            <a class="ddp-icon-query-loop-refresh" href="javascript:" style="position: static;" (click)="refresh()"></a>
          </div>
          <table class="ddp-table-form ddp-table-type3" style="width:100%">
            <colgroup>
              <col width="170px">
              <col width="*">
              <col width="130px">
              <col width="110px">
              <col width="90px">
            </colgroup>
            <thead>
            <tr>
              <th>시작 시간</th>
              <th>SQL</th>
              <th>경과 시간</th>
              <th>결과</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of dataAggregateTaskDetails.histories; let idx = index">
              <td>{{item.start}}</td>
              <td><code>{{item.sql}}</code></td>
              <td> {{item.elapsedTime}} 초</td>
              <td><span class="ddp-data-state" [ngClass]="item.status === 'SUCCESS' ? 'ddp-success' : 'ddp-fail'"> {{item.status}} </span></td>
              <td><a class="ddp-link-detail" href="javascript:" *ngIf="item.status === 'FAILURE'" (click)="showErrorDetails(item)">Detail &gt;</a></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- //cpmtemts -->
</div>
